    \documentclass[11pt,
        usenames, % allows access to some tikz colors
        dvipsnames % more colors: https://en.wikibooks.org/wiki/LaTeX/Colors
    ]{article}
    \usepackage{
        amsmath,
        amssymb,
        fouriernc, % fourier font w/ new century book
        fancyhdr, % page styling
        lastpage, % footer fanciness
        hyperref, % various links
        setspace, % line spacing
        amsthm, % newtheorem and proof environment
        mathtools, % \Aboxed for boxing inside aligns, among others
        float, % Allow [H] figure env alignment
        enumerate, % Allow custom enumerate numbering
        graphicx, % allow includegraphics with more filetypes
        wasysym, % \smiley!
        upgreek, % \upmu for \mum macro
        listings, % writing TrueType fonts and including code prettily
        tikz, % drawing things
        booktabs, % \bottomrule instead of hline apparently
        cancel % can cancel things out!
    }
    \usepackage[margin=1in]{geometry} % page geometry
    \usepackage[
        labelfont=bf, % caption names are labeled in bold
        font=scriptsize % smaller font for captions
    ]{caption}
    \usepackage[font=scriptsize]{subcaption} % subfigures

    \newcommand*{\scinot}[2]{#1\times10^{#2}}
    \newcommand*{\dotp}[2]{\left<#1\,\middle|\,#2\right>}
    \newcommand*{\rd}[2]{\frac{\mathrm{d}#1}{\mathrm{d}#2}}
    \newcommand*{\pd}[2]{\frac{\partial#1}{\partial#2}}
    \newcommand*{\rtd}[2]{\frac{\mathrm{d}^2#1}{\mathrm{d}#2^2}}
    \newcommand*{\ptd}[2]{\frac{\partial^2 #1}{\partial#2^2}}
    \newcommand*{\md}[2]{\frac{\mathrm{D}#1}{\mathrm{D}#2}}
    \newcommand*{\pvec}[1]{\vec{#1}^{\,\prime}}
    \newcommand*{\svec}[1]{\vec{#1}\;\!}
    \newcommand*{\bm}[1]{\boldsymbol{\mathbf{#1}}}
    \newcommand*{\ang}[0]{\;\text{\AA}}
    \newcommand*{\mum}[0]{\;\upmu \mathrm{m}}
    \newcommand*{\at}[1]{\left.#1\right|}

    \newtheorem{theorem}{Theorem}[section]

    \let\Re\undefined
    \let\Im\undefined
    \DeclareMathOperator{\Res}{Res}
    \DeclareMathOperator{\Re}{Re}
    \DeclareMathOperator{\Im}{Im}
    \DeclareMathOperator{\Log}{Log}
    \DeclareMathOperator{\Arg}{Arg}
    \DeclareMathOperator{\Tr}{Tr}
    \DeclareMathOperator{\E}{E}
    \DeclareMathOperator{\Var}{Var}
    \DeclareMathOperator*{\argmin}{argmin}
    \DeclareMathOperator*{\argmax}{argmax}
    \DeclareMathOperator{\sgn}{sgn}
    \DeclareMathOperator{\diag}{diag\;}

    \DeclarePairedDelimiter\bra{\langle}{\rvert}
    \DeclarePairedDelimiter\ket{\lvert}{\rangle}
    \DeclarePairedDelimiter\abs{\lvert}{\rvert}
    \DeclarePairedDelimiter\ev{\langle}{\rangle}
    \DeclarePairedDelimiter\p{\lparen}{\rparen}
    \DeclarePairedDelimiter\s{\lbrack}{\rbrack}
    \DeclarePairedDelimiter\z{\lbrace}{\rbrace}

    % \everymath{\displaystyle} % biggify limits of inline sums and integrals
    \tikzstyle{circ} % usage: \node[circ, placement] (label) {text};
        = [draw, circle, fill=white, node distance=3cm, minimum height=2em]
    \definecolor{commentgreen}{rgb}{0,0.6,0}
    \lstset{
        basicstyle=\ttfamily\footnotesize,
        frame=single,
        numbers=left,
        showstringspaces=false,
        keywordstyle=\color{blue},
        stringstyle=\color{purple},
        commentstyle=\color{commentgreen},
        morecomment=[l][\color{magenta}]{\#}
    }

\begin{document}

\def\Snospace~{\S{}} % hack to remove the space left after autorefs
\renewcommand*{\sectionautorefname}{\Snospace}
\renewcommand*{\appendixautorefname}{\Snospace}
\renewcommand*{\figureautorefname}{Fig.}
\renewcommand*{\equationautorefname}{Eq.}
\renewcommand*{\tableautorefname}{Tab.}

\section{Hamiltonians and EOM}

\subsection{Toy Problem}

Consider simplest spin Hamiltonian $H = -\vec{B} \cdot \vec{s}$. It's clear that
if we set up initial conditions $\vec{s}$ misaligned from $\vec{B}$, it will
simply spin around $\vec{B}$, which is fixed. Thus, let $\hat{B} \cdot \hat{s} =
\cos \theta$ the angle between the two, and let $\phi$ measure the azimuthal
angle.

We claim that $\cos \theta, \phi$ are canonical variables. Since $\phi$ is
ignorable, immediately $\rd{\theta}{t} = \rd{\cos \theta}{t} = -\pd{H}{\phi} =
0$, while $\rd{\phi}{t} = \pd{H}{(\cos \theta)} = Bs$ tells us the rate at which
the spin precesses around $\vec{B}$.

\subsection{Cassini State Hamilttonian}

This Hamiltonian is Kassandras Eq.\ 13, in the co-rotating frame with the
perturber's angular momentum:
\begin{equation}
    \mathcal{H} = \frac{1}{2}\p*{\hat{s} \cdot \hat{l}}^2
        - \eta \p*{\hat{s} \cdot \hat{l}_p}.
\end{equation}
In this frame, we can choose $\hat{l} \equiv \hat{z}$ fixed, and $\hat{l}_p =
\cos I\hat{z} + \sin I\hat{x}$ fixed as well. Then
\begin{equation*}
    \hat{s} = \cos\theta \hat{z}
        - \sin\theta\p*{\sin \phi \hat{y} + \cos \phi \hat{x}}.
\end{equation*}
We can choose the convention for $\phi = \phi$ azimuthal angle requiring $\phi =
0, \pi$ mean coplanarity between $\hat{s}, \hat{l}, \hat{l}_p$ in the $\hat{x},
\hat{z}$ plane such that $\hat{l}_p, \hat{s}$ lie on the same side of
$\hat{l}$. Then we can evaluate in coordinates
\begin{align*}
    \hat{s} \cdot \hat{l} &= \cos \theta,\\
    \hat{s} \cdot \hat{l}_p
        &= \cos \theta \cos I - \sin I \sin \theta \cos \phi,\\
    \mathcal{H} &= \frac{1}{2}\cos^2\theta
        - \eta \p*{\cos \theta \cos I - \sin I \sin \theta \cos \phi}.
\end{align*}
Note that if we take $\cos\theta$ to be our canonical variable, $\sin\theta =
\sqrt{1 - \cos^2\theta}$ can be used.

\subsection{Equation of Motion}

The correct EOM comes from Kassandra's Eq.\ 12:
\begin{align*}
    \rd{\hat{s}}{t} &=
        \p*{\hat{s} \cdot \hat{l}}\p*{\hat{s} \times \hat{l}}
            -\eta\p*{\hat{s} \times \hat{l}_p},\\
        &= \p*{s_ys_z - \eta s_y\cos(I)}\hat{x}
            - \p*{s_xs_z + \eta \p*{s_x\cos I - s_z\sin I}}\hat{y}
            + \eta s_y \sin(I)\hat{z}.
\end{align*}

Alternatively, consider Hamilton's equations applied to the Hamiltonian:
\begin{align}
    \pd{\phi}{t} = \pd{\mathcal{H}}{(\cos\theta)}
        &= \cos\theta - \eta\p*{\cos I + \sin I \cot \theta \cos \phi},\\
    \pd{(\cos \theta)}{t} = -\pd{\mathcal{H}}{\phi}
        &= +\eta \sin I \sin \theta \sin \phi.
\end{align}
This produces the same trajectories as the Cartesian EOM, so this is correct.
However, since $\pd{\phi}{t} \propto 1/\sin\theta$, this is not a desirable
system of equations to use, as they are very stiff near $\theta \approx 0$.

\subsection{Tidal Dissipation}

We can add a tidal dissipation term; we write it in form
$\p*{\rd{\hat{s}}{t}}_{tide} = \epsilon \hat{s} \times \p*{\hat{l} \times
\hat{s}}$. Expanding,
\begin{align}
    \p*{\rd{\hat{s}}{t}}_{tide} &= \epsilon \p*{\hat{z} - s_z\hat{s}}
        ,\nonumber\\
        &= \epsilon \p*{-s_z s_x\hat{x} - s_zs_y\hat{y} + \p*{1 - s_z^2}
            \hat{z}}.
\end{align}
We run numerical simulations for weaker $\epsilon \ll \eta \ll 1$ and stronger
$\epsilon \lesssim \eta \ll 1$.

We can seek equilibria of the the system including tides, which requires
\begin{align*}
    0 &= s_ys_z - \eta s_y\cos I - \epsilon s_zs_x,\\
    0 &= -s_xs_z - \eta\p*{s_x \cos I - s_z \sin I} - \epsilon s_zs_y,\\
    0 &= \eta s_y\sin(I) + \epsilon \p*{1 - s_z^2}.
\end{align*}
We expect at least two equilibria, based on the simulations: one near $s_z
\approx 1$ and one $s_z \approx 0$.

For near alignment/near Cassini state $1$, $1 - s_z \sim 1 - s_{\perp}^2$, so we
can set $s_z = 1$ to first order: $s_y - \epsilon s_x - \eta s_y \cos I = -s_x -
\eta\p*{s_x \cos I - \sin I} - \epsilon s_y = \eta s_y \sin I = 0$. This can be
satisfied if we set $s_x = \tan(I) \ll 1, s_y = \mathcal{O}\p*{\epsilon s_x}$;
this coarsely corresponds to Cassini state $1$.

The other solution should be near Cassini state $2$, where $s_x \approx 1$;
dropping second order terms forces $\eta s_y + \epsilon s_z = -s_z -
\eta\p*{\cos I - s_z\sin I} = \eta s_y \sin(I) + \epsilon = 0$. This can thus be
satisfied for $s_y \approx -\frac{\epsilon}{\eta \sin(I)}$. Thus, this explains
why as $\epsilon$ is increased, we first start to get points that don't converge
to Cassini state $2$ in the absence of tides, before starting to see points that
fail to converge to Cassini state $1$.

\end{document}

